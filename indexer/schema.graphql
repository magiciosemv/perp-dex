# Day 1: 保证金事件
type MarginEvent @entity {
  id: ID!
  trader: String!
  amount: BigInt!
  eventType: String!  # "DEPOSIT" 或 "WITHDRAW"
  timestamp: Int!
  txHash: String!
}

# Day 2: 订单
type Order @entity {
  id: ID!
  trader: String!
  isBuy: Boolean!
  price: BigInt!
  initialAmount: BigInt!
  amount: BigInt!
  status: String!  # "OPEN", "FILLED", "CANCELLED"
  timestamp: Int!
}

# Day 3: 成交记录
type Trade @entity {
  id: ID!
  buyer: String!
  seller: String!
  price: BigInt!
  amount: BigInt!
  timestamp: Int!
  txHash: String!
  buyOrderId: BigInt!
  sellOrderId: BigInt!
}

# Day 3: 持仓
type Position @entity {
  id: ID!  # trader address
  trader: String!
  size: BigInt!
  entryPrice: BigInt!
}

# Day 5: K 线数据
type Candle @entity {
  id: ID!  # "1m-timestamp"
  resolution: String!
  timestamp: Int!
  openPrice: BigInt!
  highPrice: BigInt!
  lowPrice: BigInt!
  closePrice: BigInt!
  volume: BigInt!
}

# Day 5: 最新价格状态（用于新 K 线的 open 价格）
type LatestCandle @entity {
  id: ID!  # "1"
  closePrice: BigInt!
  timestamp: Int!
}

# Day 6: 资金费率事件
type FundingEvent @entity {
  id: ID!
  eventType: String!  # "GLOBAL_UPDATE" 或 "USER_PAID"
  trader: String      # 仅 USER_PAID 时有值
  cumulativeRate: BigInt
  payment: BigInt     # 仅 USER_PAID 时有值
  timestamp: Int!
}

# Day 7: 清算记录
type Liquidation @entity {
  id: ID!
  trader: String!
  liquidator: String!
  amount: BigInt!
  fee: BigInt!
  timestamp: Int!
  txHash: String!
}

# Day 8+: 用户交易量统计（30天滚动窗口）
type UserVolume @entity {
  id: ID!  # trader address
  trader: String!
  volume30Days: BigInt!  # 30天累计交易量（USD计价）
  lastUpdated: Int!
}

# Day 8+: 返佣统计
type ReferralStat @entity {
  id: ID!  # referrer address
  referrer: String!
  inviteCount: Int!  # 已邀请人数
  totalRebateEarned: BigInt!  # 累计已赚取返佣（MON）
  lastUpdated: Int!
}

# Day 8+: 返佣支付记录
type RebatePayment @entity {
  id: ID!
  trader: String!
  referrer: String!
  feeAmount: BigInt!
  rebateAmount: BigInt!
  timestamp: Int!
  txHash: String!
}

# Day 8+: VIP等级变更记录
type VIPLevelChange @entity {
  id: ID!
  trader: String!
  oldLevel: Int!
  newLevel: Int!
  timestamp: Int!
  txHash: String!
}
